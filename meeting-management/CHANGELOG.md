# CHANGELOG

```yaml
meta:
  project: "meeting-management"
  version: "0.9-beta"
  updated: "2026-02-25"
```

---

## v1.0 (进行中 — 2026-02-25)

**目标**：从 Skill 升级为灵犀"帮我听"功能模块，完成基础闭环

**架构重构**
- [x] 明确模块定位：灵犀"帮我听"声音模块 (2026-02-25)
- [x] 确定架构原则：服务器处理、长连接、AI 驱动、前端纯展示 (2026-02-25)
- [x] 规划演进路线：V1.0 基础闭环 → V1.5 实时增强 → V2.0 智能沉淀 (2026-02-25)

**严重问题修复** (2026-02-25)
- [x] **AI 填充缺失**：接入 DeepSeek AI 替代规则引擎 (2026-02-25)
  - 结论率：0% → **100%**
  - 行动项：6个错5个 → **4个全对**
  - 新增 `ai_minutes_generator.py` 模块
  - `generate_minutes()` 现在默认使用 AI 生成
- [x] **规则引擎弃用**：`_extract_topics_with_conclusion()` 等函数已弃用 (2026-02-25)
- [ ] **无实时推送**：WebSocket 只接收 Handy 流，不推送给前端

**稳定化改进** (2026-02-25)
- [x] **AI 生成增强**: 添加重试机制和边界处理 (2026-02-25)
  - 新增：可配置重试次数 (默认3次)、请求超时 (默认60秒)
  - 新增：文本长度验证和自动截断 (最大15000字符)
  - 新增：API 错误分类处理 (401/429/503)
  - 新增：详细日志记录（响应时间、重试次数）
  - 新增：降级策略（AI失败时返回基础结构）
  - 更新：`ai_minutes_generator.py` 完全重写
- [x] **WebSocket 健壮性**: 异常处理和会话管理 (2026-02-25)
  - 新增：会话超时自动清理 (60分钟无活动)
  - 新增：消息大小限制 (1MB)
  - 新增：详细的连接/断开日志
  - 新增：异常数据包处理和错误响应
  - 新增：后台清理任务（每5分钟检查一次）
  - 新增：管理接口 `/api/admin/cleanup`
  - 更新：`websocket_server.py` 增强
- [x] **日志系统**: 统一日志配置 (2026-02-25)
  - 新增：`src/logger_config.py` 统一日志模块
  - 新增：控制台 + 文件双输出
  - 新增：错误日志单独文件
  - 新增：会话上下文日志支持
- [x] **边界处理工具**: 安全和资源检查 (2026-02-25)
  - 新增：`src/utils.py` 工具模块
  - 新增：磁盘空间检查 (默认最小100MB)
  - 新增：安全文件写入（原子性、异常回滚）
  - 新增：内存使用检查
  - 新增：超时装饰器（跨平台）
  - 新增：计时器上下文管理器

**修复** (2026-02-25)
- [x] **BUG-003**: 修复 `update_meeting` 中 action_items 反序列化错误 (2026-02-25)
  - 问题：JSON 加载后 action_items 是字典列表，直接传给 Topic 导致 to_dict() 失败
  - 解决：添加 `_rebuild_topic` 函数正确处理嵌套 ActionItem

**测试完成** (2026-02-25)
- [x] E2E测试：WebSocket→转写→会议纪要生成全流程 (2026-02-25)
  - 结果：技术链路通过，内容质量不可接受
- [x] 功能缺口测试：6大缺口识别 (2026-02-25)
  - P0：AI生成、实时推送、状态持久化
  - P1：用户隔离、音频输入多样性
  - P2：知识库集成
- [x] 边界测试：空文本/超长文本/特殊字符/大量行动项 (2026-02-25)
  - 结果：全部通过
- [x] AI vs 规则引擎对比测试：结论率 0%→100%，行动项准确率显著提升 (2026-02-25)

**稳定化测试** (2026-02-25)
- [x] **STABLE-002 测试**：稳定化改进验证 (2026-02-25)
  - 新增：`test/test_stable_001.py` 综合测试脚本
  - 测试覆盖：
    - 磁盘空间检查（正常/异常场景）
    - 安全文件写入（文本/JSON）
    - 文本截断和验证
    - 转写文本处理（空/短/超长文本）
    - 会议纪要标准化
    - AI 失败降级
    - 端到端边界情况
  - 结果：**10/10 测试全部通过**

**未来方向** (2026-02-25)
- [ ] 知识库打通：等灵犀接口稳定后对接 (parked)
- [ ] 实时推送：当前会后生成模式够用 (parked)
- [ ] 状态持久化：当前内存存储够用 (parked)

**架构决策**
- 测试作为地基：完整测试清单保留在 docs/测试清单.md
- 不再过度工程：优先修 bug，暂停新功能
- 当前可用：AI 纪要生成稳定可用

**新增**
- [x] LifeOS AI 协作协议文档初始化 (2026-02-25)
- [x] PROJECT_CONTEXT.md 创建 (2026-02-25)
- [x] SESSION_STATE.yaml 创建 (2026-02-25)
- [x] CHANGELOG.md 创建 (2026-02-25)
- [x] 业务流程推演与缺口分析 (2026-02-25)
- [ ] WebSocket 端到端集成测试
- [ ] 实时转写链路验证（音频→服务器→字幕推送）
- [ ] 会议纪要生成与存储
- [ ] 历史查询接口（会议列表/详情/统计）

**技术债务**
- [ ] 接入通义千问 API 替代规则引擎
- [ ] 数据库持久化层（SQLite）
- [ ] 删除 _extract_topics_with_conclusion 等弃用函数

**架构决策**
- **定位**：灵犀"帮我听"功能模块，用户直接交互
- **处理**：服务器端（音频转写/语义理解/数据存储）
- **通信**：WebSocket 长连接，双向实时
- **数据流**：音频用户→服务器→处理结果→用户展示
- **AI 角色**：控制会议生命周期、处理语义、响应查询

---

## v0.9 (2026-02-24)

**新增**
- [x] WebSocket 服务端 (`scripts/websocket_server.py`)
- [x] 实时转写流接收与存储
- [x] 行动项全局台账 (`action_registry.json`)
- [x] 完整流程演示 (`demo_full_flow.py`)

---

## v0.8 (2026-02-22)

**新增**
- [x] 核心 Skill 接口 (`src/meeting_skill.py`)
  - `transcribe()` - Whisper 音频转写
  - `create_meeting_skeleton()` - 创建会议骨架
  - `save_meeting()` - JSON + Word 导出
  - `query_meetings()` - 历史查询
  - `update_meeting()` - 版本更新
- [x] 数据模型：Meeting, Topic, ActionItem
- [x] Word 文档生成（python-docx）
- [x] 分级存储目录结构 (`output/meetings/YYYY/MM/`)

**架构决策**
- 弃用规则引擎提取：`_extract_topics_with_conclusion()` 等函数效果差（结论命中率0%，行动项噪音30%），改由 AI 层负责语义理解
- 关联实体预留：PolicyRef, EnterpriseRef, ProjectRef 为未来政策/企业/项目关联设计预留

---

## 版本模板（复制使用）

```markdown
## vX.Y.Z (YYYY-MM-DD)

**新增**
- [x] 已完成功能 (YYYY-MM-DD)
- [ ] 待完成功能

**修复**
- [x] Bug描述 (YYYY-MM-DD)

**架构决策**
- 选择了X而不是Y，原因是...
```

---

*规则：TODO 必须在此文件登记；完成时标记 `[x]` 并记录日期*
