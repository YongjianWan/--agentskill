# Phase 5: 历史检索完善

> 目标：会议历史管理增强（版本控制、高级搜索、批量操作）

---

## 背景

已完成准备：`SCHEMA-001` 已添加 `minutes_history` JSON字段
- 每次重新生成纪要时，自动 append 旧版本到 history
- 为 Phase 5 提供数据基础

---

## 功能规划

### 1. 纪要版本管理 ⭐⭐⭐

| 功能 | 说明 | API设计 |
|------|------|---------|
| **版本列表** | 查看某会议的所有纪要版本 | `GET /meetings/{id}/versions` |
| **版本对比** | 对比两个版本的差异 | `POST /meetings/{id}/versions/compare` |
| **版本回滚** | 恢复到某个历史版本 | `POST /meetings/{id}/versions/{ver}/rollback` |
| **版本详情** | 查看特定版本内容 | `GET /meetings/{id}/versions/{ver}` |

**数据模型**（已具备）：
```json
{
  "minutes_history": [
    {
      "version": 1,
      "created_at": "2026-02-27T10:00:00",
      "template": "detailed",
      "content": { "summary": "...", "topics": [...] }
    },
    {
      "version": 2,
      "created_at": "2026-02-27T11:30:00",
      "template": "concise",
      "content": { "summary": "...", "topics": [...] }
    }
  ]
}
```

---

### 2. 高级搜索 ⭐⭐

| 功能 | 说明 | 实现方式 |
|------|------|----------|
| **全文检索** | 搜索会议内容、转写文本 | SQL `LIKE` 或 PostgreSQL 全文搜索 |
| **时间范围** | 按日期筛选 | 已有 `?start_date=&end_date=` |
| **参会人筛选** | 按用户ID搜索 | `?participant_id=xxx` |
| **标签/主题** | 按议题关键词搜索 | 解析 `topics` JSON 字段 |
| **状态筛选** | 已完成/进行中 | 已有 `?status=` |

**API扩展**：
```http
GET /meetings?keyword=预算&start_date=2026-01-01&participant_id=user123&has_action_items=true
```

---

### 3. 批量操作 ⭐⭐

| 功能 | 说明 | API设计 |
|------|------|---------|
| **批量导出** | 选多个会议批量下载 | `POST /meetings/batch/export` |
| **批量删除** | 清理历史会议 | `DELETE /meetings/batch` |
| **统计报表** | 会议时长/数量统计 | `GET /meetings/stats` |

---

### 4. 数据可视化（可选）⭐

- 会议时长趋势图
- 参会频率统计
- 行动项完成情况

---

## 实施计划

### 阶段 A：版本管理（2-3天）
- [ ] 版本列表接口
- [ ] 版本详情接口
- [ ] 版本对比功能（文本 diff）
- [ ] 版本回滚功能

### 阶段 B：高级搜索（1-2天）
- [ ] 全文检索接口
- [ ] 组合筛选优化
- [ ] 搜索结果高亮

### 阶段 C：批量操作（1-2天）
- [ ] 批量导出（ZIP）
- [ ] 统计报表接口

---

## 优先级建议

| 优先级 | 功能 | 理由 |
|--------|------|------|
| **P0** | 版本列表 + 回滚 | 用户重新生成纪要后想找回旧版本 |
| **P1** | 全文检索 | 会议多了之后快速定位 |
| **P2** | 批量导出 | 季度/年度归档 |
| **P3** | 可视化 | 锦上添花 |

---

## 何时启动？

**建议触发条件**：
1. 用户反馈需要找回旧版本纪要
2. 会议数量 > 100 条，难以手动查找
3. 需要批量导出季度报告

**当前建议**：先不开发，收集需求后再细化。
