好，代码看完了。现在可以写有用的测试清单了——每条有输入、期望输出、判定标准，不是 checkbox。

---

## 会议管理模块测试清单 v1.0

> 测试原则：测试文件只读，发现失败只改 src/ 下的代码

---

### 一、REST API 边界测试

#### 1.1 创建会议 `POST /api/v1/meetings`

| # | 输入                                   | 期望 HTTP | 期望返回                              | 判定标准                                      |
| - | -------------------------------------- | --------- | ------------------------------------- | --------------------------------------------- |
| 1 | `title="周一例会", user_id="u001"`   | 200       | `code=0`,`session_id`以 `M`开头 | session_id 格式：`M\d{8}_\d{6}_[a-f0-9]{6}` |
| 2 | `title=""`                           | 422       | 验证错误                              | title 不能为空                                |
| 3 | `title="a"*201`                      | 422       | 验证错误                              | title 超过 200 字符                           |
| 4 | `user_id`缺失                        | 422       | 验证错误                              | user_id 必填                                  |
| 5 | `title="正常标题"`但不带 `user_id` | 422       | 验证错误                              | 不能靠默认值绕过                              |

#### 1.2 状态机流转

| # | 前置状态            | 操作        | 期望                   | 判定标准                |
| - | ------------------- | ----------- | ---------------------- | ----------------------- |
| 1 | created             | `/start`  | 200, status=recording  | start_time 不为 null    |
| 2 | created             | `/pause`  | 400                    | detail 含"未在录音状态" |
| 3 | recording           | `/start`  | 400                    | detail 含"状态错误"     |
| 4 | recording           | `/pause`  | 200, status=paused     | -                       |
| 5 | paused              | `/resume` | 200, status=recording  | -                       |
| 6 | paused              | `/end`    | 200, status=processing | -                       |
| 7 | completed           | `/end`    | 400                    | 不能重复结束            |
| 8 | 不存在的 session_id | `/start`  | 404                    | -                       |

#### 1.3 结束会议 `POST /meetings/{id}/end` 【✅ 已测试 2026-02-27】

| # | 输入                             | 期望            | 判定标准                  |
| - | -------------------------------- | --------------- | ------------------------- |
| 1 | `template_style=detailed`      | 200, processing | 异步任务启动              |
| 2 | `template_style=invalid_style` | 400             | detail 含"无效的模板风格" |
| 3 | 省略 template_style              | 200             | 默认使用 detailed         |

#### 1.4 会议列表 `GET /meetings` 【✅ 已测试 2026-02-27】

| # | 输入                                          | 期望 | 判定标准                     |
| - | --------------------------------------------- | ---- | ---------------------------- |
| 1 | 无参数                                        | 200  | list 是数组，total 是整数    |
| 2 | `start_date=2026-01-01&end_date=2026-12-31` | 200  | 返回结果 created_at 在范围内 |
| 3 | `start_date=not-a-date`                     | 400  | detail 含"格式错误"          |
| 4 | `status=recording`                          | 200  | list 中所有 status=recording |
| 5 | `status=nonexistent`                        | 400  | detail 含"无效的状态"        |
| 6 | `keyword=测试`                              | 200  | title 或 full_text 含"测试"  |
| 7 | `page=0`                                    | 422  | page 最小值是 1              |
| 8 | `page_size=200`                             | 422  | page_size 最大值是 100       |

#### 1.5 下载接口 `GET /meetings/{id}/download` 【✅ 已测试 2026-02-27】

| # | 前置状态                | format         | 期望                                               | 判定标准                         |
| - | ----------------------- | -------------- | -------------------------------------------------- | -------------------------------- |
| 1 | completed + docx 存在   | docx           | 200 FileResponse                                   | Content-Type 是 wordprocessingml |
| 2 | processing              | docx           | 409                                                | detail 含"未处理完成"            |
| 3 | completed               | `format=xml` | 注意：代码没做校验，实际会走 else 分支当 docx 处理 | **这是 bug，需要加 400**   |
| 4 | completed               | json           | 200                                                | 返回 JSON 含 session_id, title   |
| 5 | completed + docx 不存在 | docx           | 404                                                | detail 含"尚未生成"              |

#### 1.6 转写片段更新 【✅ 已测试 2026-02-27】

| # | 输入                                   | 期望 | 判定标准                           |
| - | -------------------------------------- | ---- | ---------------------------------- |
| 1 | 有效 segment_id, text="修正后的文字"   | 200  | full_text 同步更新含新文字         |
| 2 | 不存在的 segment_id                    | 404  | detail 含"片段不存在"              |
| 3 | 空 text                                | 200  | 允许清空（当前代码没校验，看需求） |
| 4 | 批量更新 3 个片段，其中 1 个 id 不存在 | 200  | updated_count=2, total_count=3     |

---

### 二、健康检查验证（已验证，记录标准）

| 字段                          | 期望类型 | 期望值                     | 验证方式                   |
| ----------------------------- | -------- | -------------------------- | -------------------------- |
| `status`                    | string   | ok/degraded/error 之一     | 枚举检查                   |
| `model.loaded`              | boolean  | 服务启动后为 true          | 启动后立即查，不能是 false |
| `model.name`                | string   | 等于 .env 中 WHISPER_MODEL | 对比环境变量               |
| `disk.free_gb`              | float    | > 0 且 < total_gb          | 合理性检查                 |
| `websocket.active_sessions` | int      | 连接前=0，连接后=1         | 动态验证                   |
| `uptime_seconds`            | int      | 启动后随时间递增           | 两次查询，第二次 > 第一次  |

---

### 三、已修复的 Bug

| Bug   | 位置                      | 描述                                                            | 状态 |
| ----- | ------------------------- | ----------------------------------------------------------------| ---- |
| B-001 | `meetings.py`download   | `format=xml`不报 400，走 docx 逻辑                              | ✅ 已修复 - 添加format参数校验 |
| B-002 | `meetings.py`regenerate | `meeting.minutes_history`字段不存在                             | ✅ 已修复 - 使用现有字段存储 |
| B-003 | `meetings.py`end        | `meeting.minutes`字段不存在                                     | ✅ 已修复 - 使用现有字段存储 |
| B-004 | `system.py`             | `model.loaded`启动后仍为 false                                  | ✅ 已修复(FIX-016) - 启动时预加载模型 |

---

### 四、不测什么（明确排除）

* 性能/压力测试——单体内网服务，当前不需要
* 安全测试（SQL注入/XSS）——内网部署，非公开服务，暂缓
* 多租户隔离——暂缓
* Safari/移动端兼容——不在当前范围

---

把 B-001、B-002、B-003 告诉本地 AI 先修，这三个是代码逻辑错误不是测试问题。测试清单的执行等这三个修完再跑。

# 会议管理模块测试清单

> 用于确保测试完整性，逐项检查无遗漏

---

## 测试进度总览

| 阶段       | 状态        | 完成度 |
| ---------- | ----------- | ------ |
| 单元测试   | ⏳ 部分完成 | 60%    |
| 集成测试   | ✅ 已完成   | 100%   |
| E2E 测试   | ✅ 已完成   | 100%   |
| 性能测试   | ❌ 未开始   | 0%     |
| 安全测试   | ❌ 未开始   | 0%     |
| 兼容性测试 | ❌ 未开始   | 0%     |

---

## 一、核心功能测试

### 1.1 音频转写 (transcribe)

- [ ] **正常转写**：标准 MP3/WAV 文件
- [ ] **长音频**：> 30 分钟音频
- [ ] **短音频**：< 10 秒音频
- [ ] **中文识别**：普通话内容
- [ ] **英文识别**：English content
- [ ] **中英混合**：中英文混杂
- [ ] **方言识别**：粤语/四川话等（如有需求）
- [ ] **噪音环境**：背景噪音较大的音频
- [ ] **多人对话**：多人发言区分
- [ ] **静音段落**：包含长段静音的音频
- [ ] **文件不存在**：传入不存在的路径
- [ ] **格式不支持**：非音频文件
- [ ] **损坏文件**：损坏的音频文件

**状态**：❌ 未系统测试

---

### 1.2 会议创建 (create_meeting_skeleton)

- [X] 正常创建
- [X] 空转写文本
- [X] 超长转写文本
- [X] 特殊字符内容
- [ ] 包含敏感词的文本
- [ ] 编码异常文本

**状态**：✅ 基本场景完成

---

### 1.3 会议保存 (save_meeting)

- [X] 正常保存（JSON + DOCX）
- [X] 大量行动项（100+）
- [ ] 超大会议（topics > 50）
- [ ] 磁盘满的情况
- [ ] 无写入权限目录
- [ ] 中文路径
- [ ] 特殊字符路径
- [ ] 网络存储路径

**状态**：⏳ 部分完成

---

### 1.4 会议查询 (query_meetings)

- [X] 按日期范围查询
- [X] 按参会人查询
- [X] 按关键词查询
- [ ] 组合条件查询
- [X] 查询无结果
- [X] 超大结果集（>1000条）
- [ ] 并发查询
- [ ] 查询性能（< 1秒）

**状态**：⏳ 部分完成

---

### 1.5 会议更新 (update_meeting)

- [X] 正常更新
- [X] 更新不存在的会议
- [X] 多次更新（版本链）
- [ ] 并发更新同一会议
- [ ] 更新时文件被占用

**状态**：✅ 基本场景完成

---

## 二、WebSocket 实时功能测试

### 2.1 连接管理

- [X] 正常连接
- [ ] 连接断开重连
- [ ] 网络抖动恢复
- [ ] 同时连接数限制
- [ ] 非法路径连接
- [ ] 未授权连接

**状态**：⏳ 部分完成

### 2.2 消息处理

- [X] session_start 消息
- [X] transcription 消息
- [X] session_end 消息
- [X] metadata 消息
- [X] ping/pong 心跳
- [ ] 乱序消息处理
- [ ] 重复消息处理
- [ ] 超大消息（>1MB）
- [ ] 非法 JSON 消息

**状态**：⏳ 部分完成

### 2.3 实时推送

- [ ] 转写结果推送
- [ ] 议题标记推送
- [ ] 状态变更推送
- [ ] 批量推送性能
- [ ] 推送失败重试

**状态**：❌ 功能未实现

---

## 三、AI 生成能力测试

### 3.1 议题提取

- [ ] 单议题会议
- [ ] 多议题会议
- [ ] 议题边界模糊
- [ ] 无明确议题
- [ ] 议题切换频繁

**状态**：❌ 需接入 LLM

### 3.2 结论识别

- [ ] 明确结论
- [ ] 无结论讨论
- [ ] 多结论议题
- [ ] 模糊结论
- [ ] 结论在开头/中间/结尾

**状态**：❌ 当前准确率 0%

### 3.3 行动项提取

- [ ] 明确行动项（谁+做什么+何时）
- [ ] 隐含行动项
- [ ] 多人负责的行动项
- [ ] 无明确截止时间的行动项
- [ ] 重复确认的行动项

**状态**：❌ 当前准确率 16%

### 3.4 风险点识别

- [ ] 明确风险表述
- [ ] 隐含风险
- [ ] 误报过滤（如"没问题"）

**状态**：❌ 当前准确率 33%

---

## 四、业务场景测试

### 4.1 会议类型

- [ ] 日常站会（短、快）
- [ ] 产品评审会
- [ ] 技术评审会
- [ ] 项目周会
- [ ] 季度规划会
- [ ] 临时讨论
- [ ] 一对一会谈
- [ ] 头脑风暴

**状态**：❌ 未测试

### 4.2 使用场景

- [X] 正常会议室环境
- [ ] 嘈杂环境（咖啡厅/机场）
- [ ] 线上会议（腾讯会议/Zoom/Teams）
- [ ] 电话会议
- [ ] 混合会议（线上+线下）

**状态**：⏳ 部分完成

---

## 五、性能测试

### 5.1 转写性能

- [ ] 1 分钟音频处理时间
- [ ] 10 分钟音频处理时间
- [ ] 60 分钟音频处理时间
- [ ] CPU 占用率
- [ ] 内存占用

**状态**：❌ 未测试

### 5.2 并发性能

- [ ] 10 并发会议
- [ ] 100 并发会议
- [ ] 响应时间 < 100ms
- [ ] 消息丢失率 0%

**状态**：❌ 未测试

### 5.3 存储性能

- [ ] 写入性能（条/秒）
- [ ] 查询性能（< 1秒）
- [ ] 大数据量查询（10万条）

**状态**：❌ 未测试

---

## 六、安全测试

### 6.1 输入安全

- [ ] SQL 注入
- [ ] XSS 攻击
- [ ] 路径遍历
- [ ] 超大输入
- [ ] 特殊字符注入

**状态**：❌ 未测试

### 6.2 访问控制

- [ ] 用户身份验证
- [ ] 会议访问权限
- [ ] 操作权限控制
- [ ] Token 过期处理

**状态**：❌ 功能未实现

### 6.3 数据安全

- [ ] 敏感信息脱敏
- [ ] 音频文件加密
- [ ] 传输加密（WSS）
- [ ] 存储加密

**状态**：❌ 未测试

---

## 七、兼容性测试

### 7.1 客户端兼容

- [ ] Chrome 浏览器
- [ ] Firefox 浏览器
- [ ] Safari 浏览器
- [ ] Edge 浏览器
- [ ] 移动端浏览器
- [ ] 微信小程序

**状态**：❌ 未测试

### 7.2 音频源兼容

- [X] Handy 桌面端
- [ ] 浏览器 WebRTC
- [ ] iOS App
- [ ] Android App
- [ ] 会议软件 API

**状态**：⏳ 部分完成

### 7.3 系统兼容

- [X] Windows
- [ ] macOS
- [ ] Linux
- [ ] Docker 环境

**状态**：⏳ 部分完成

---

## 八、可靠性测试

### 8.1 容错恢复

- [ ] 服务重启恢复
- [ ] 网络断线恢复
- [ ] 客户端崩溃恢复
- [ ] 数据库故障恢复

**状态**：❌ 未测试

### 8.2 降级策略

- [ ] AI 服务异常降级
- [ ] 存储满降级
- [ ] 高负载降级
- [ ] 低质量音频处理

**状态**：❌ 未测试

---

## 九、用户体验测试

### 9.1 实时体验

- [ ] 延迟 < 3 秒
- [ ] 字幕同步
- [ ] 无卡顿
- [ ] 断线提示

**状态**：❌ 未测试

### 9.2 纪要质量

- [ ] 关键信息完整
- [ ] 逻辑清晰
- [ ] 无遗漏
- [ ] 易读性

**状态**：❌ 当前不可接受

---

## 十、文档与日志

### 10.1 文档

- [X] API 文档
- [X] 使用说明
- [X] 架构文档
- [ ] 部署文档
- [ ] 运维手册

**状态**：⏳ 部分完成

### 10.2 日志

- [ ] 操作日志
- [ ] 错误日志
- [ ] 性能日志
- [ ] 审计日志
- [ ] 日志轮转

**状态**：❌ 未测试

---

## 测试完成标准

| 优先级         | 完成度要求 | 当前状态 |
| -------------- | ---------- | -------- |
| P0（核心功能） | 100%       | ⏳ 80%   |
| P1（重要功能） | 80%        | ⏳ 30%   |
| P2（增强功能） | 50%        | ❌ 10%   |

---

## 下一步测试计划

1. **立即执行**：音频转写全面测试
2. **本周完成**：AI 接入后效果验证
3. **下周完成**：性能基准测试
4. **持续进行**：安全测试

---

---

## 十一、功能缺口汇总

> 合并自 功能缺口测试报告.md

### 严重缺口（P0）

| 缺口           | 现状                       | 影响             |
| -------------- | -------------------------- | ---------------- |
| AI 生成能力    | ✅ 已修复（接入 DeepSeek） | 结论率 0%→100%  |
| WebSocket 推送 | ❌ 只返回 ack              | 前端无法实时展示 |
| 状态持久化     | ❌ 内存存储                | 服务重启丢数据   |

### 重要缺口（P1）

| 缺口           | 现状       |
| -------------- | ---------- |
| 用户权限隔离   | 无 user_id |
| 音频输入多样性 | 仅 Handy   |

### 一般缺口（P2）

| 缺口       | 现状       |
| ---------- | ---------- |
| 知识库集成 | 待灵犀接口 |

---

*最后更新：2026-02-25*
*清单版本：v1.0*
