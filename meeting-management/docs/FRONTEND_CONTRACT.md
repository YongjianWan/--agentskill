# å‰åç«¯è”è°ƒåè®®

> **æœ¬æ–‡æ¡£æ˜¯å‰åç«¯è”è°ƒçš„å”¯ä¸€æ ‡å‡†**ï¼Œä»»ä½•äº‰è®®ä»¥æœ¬æ–‡æ¡£ä¸ºå‡†ã€‚

## ğŸ”— WebSocket è¿æ¥

```
ws://{host}:8765/api/v1/ws/meeting/{meeting_id}?user_id={user_id}
```

| å‚æ•°           | å¿…å¡« | è¯´æ˜                                           |
| -------------- | ---- | ---------------------------------------------- |
| `meeting_id` | âœ…   | ä¼šè®®å”¯ä¸€IDï¼Œå»ºè®®æ ¼å¼ `M{timestamp}_{random}` |
| `user_id`    | âœ…   | ç”¨æˆ·æ ‡è¯†ï¼Œå¦‚ `user_001`                      |

## ğŸ“¤ ä¸Šè¡Œæ¶ˆæ¯ï¼ˆå‰ç«¯ â†’ åç«¯ï¼‰

### 1. å¼€å§‹ä¼šè®®

```json
{
  "type": "start",
  "title": "äº§å“è¯„å®¡ä¼š"
}
```

**æ—¶æœº**: WebSocket è¿æ¥æˆåŠŸåç«‹å³å‘é€

### 2. éŸ³é¢‘æ•°æ®

```json
{
  "type": "chunk",
  "sequence": 1,
  "data": "base64ç¼–ç çš„éŸ³é¢‘æ•°æ®"
}
```

**æ—¶æœº**: MediaRecorder æ¯ 1 ç§’å›è°ƒæ—¶å‘é€
**æ³¨æ„**:

- sequence ä» 0 å¼€å§‹é€’å¢
- data æ˜¯ Base64 ç¼–ç çš„ webm/opus éŸ³é¢‘

### 3. ç»“æŸä¼šè®®

```json
{
  "type": "end"
}
```

**æ—¶æœº**: ç”¨æˆ·ç‚¹å‡»"ç»“æŸä¼šè®®"æŒ‰é’®

### 4. å¿ƒè·³ï¼ˆå¯é€‰ï¼‰

```json
{
  "type": "ping"
}
```

---

## ğŸ“¥ ä¸‹è¡Œæ¶ˆæ¯ï¼ˆåç«¯ â†’ å‰ç«¯ï¼‰

### æ¶ˆæ¯ç±»å‹æ€»è§ˆ

| ç±»å‹           | è§¦å‘æ—¶æœº     | å¿…é¡»å¤„ç†  |
| -------------- | ------------ | --------- |
| `started`    | ä¼šè®®å¼€å§‹æˆåŠŸ | âœ…        |
| `transcript` | å®æ—¶è½¬å†™ç»“æœ | âœ…        |
| `progress`   | ç”Ÿæˆçºªè¦è¿›åº¦ | âš ï¸ å»ºè®® |
| `processing` | å¤„ç†çŠ¶æ€æ›´æ–° | âš ï¸ å»ºè®® |
| `completed`  | ä¼šè®®å®Œæˆ     | âœ…        |
| `error`      | å‘ç”Ÿé”™è¯¯     | âœ…        |
| `pong`       | å¿ƒè·³å“åº”     | âŒ å¯é€‰   |

---

### 1. started - ä¼šè®®å·²å¼€å§‹

```json
{
  "type": "started",
  "meeting_id": "M20260227_123456_abc123",
  "audio_path": "output/meetings/2026/02/xxx/audio.webm"
}
```

**å‰ç«¯åŠ¨ä½œ**: æ”¶åˆ°åå¼€å§‹å½•éŸ³ï¼ˆMediaRecorder.start(1000)ï¼‰

---

### 2. transcript - å®æ—¶è½¬å†™

```json
{
  "type": "transcript",
  "text": "è¿™æ˜¯è½¬å†™çš„æ–‡æœ¬å†…å®¹",
  "sequence": 5,
  "is_final": false
}
```

**é¢‘ç‡**: æ¯ 30 ç§’ä¸€æ¬¡ï¼ˆç´¯ç§¯éŸ³é¢‘è¾¾åˆ° 30 ç§’æ—¶è§¦å‘ï¼‰
**å‰ç«¯åŠ¨ä½œ**: å°† text è¿½åŠ æ˜¾ç¤ºåœ¨è½¬å†™åŒºåŸŸ

---

### 3. progress - ç”Ÿæˆè¿›åº¦ï¼ˆæ–°å¢ï¼‰

```json
{
  "type": "progress",
  "step": "generating",
  "message": "æ­£åœ¨ç”Ÿæˆä¼šè®®çºªè¦ï¼ˆAIå¤„ç†ä¸­ï¼‰...",
  "timestamp": "2026-02-27T10:30:00.123Z"
}
```

**step å–å€¼**:

| step             | è¯´æ˜           | é¢„è®¡æ—¶é—´ |
| ---------------- | -------------- | -------- |
| `start`        | å¼€å§‹å¤„ç†       | < 1s     |
| `closing`      | å…³é—­éŸ³é¢‘æ–‡ä»¶   | < 1s     |
| `reading`      | è¯»å–éŸ³é¢‘æ•°æ®   | 1-2s     |
| `transcribing` | è½¬å†™å‰©ä½™éŸ³é¢‘   | 3-10s    |
| `generating`   | AI ç”Ÿæˆçºªè¦    | 5-15s    |
| `saving`       | å¯¼å‡º Word æ–‡æ¡£ | 1-2s     |
| `error`        | å¤„ç†å‡ºé”™       | -        |

**å‰ç«¯åŠ¨ä½œ**: æ˜¾ç¤ºè¿›åº¦æç¤º/loading åŠ¨ç”»

---

### 4. processing - å¤„ç†çŠ¶æ€

```json
{
  "type": "processing",
  "status": "started",
  "message": "å¼€å§‹ç”Ÿæˆä¼šè®®çºªè¦..."
}
```

**å‰ç«¯åŠ¨ä½œ**: å¯å¿½ç•¥æˆ–æ˜¾ç¤ºåœ¨çŠ¶æ€æ 

---

### 5. completed - ä¼šè®®å®Œæˆ â­

```json
{
  "type": "completed",
  "meeting_id": "M20260227_123456_abc123",
  "full_text": "å®Œæ•´è½¬å†™æ–‡æœ¬...",
  "minutes_path": "output/meetings/2026/02/xxx/minutes_v1.docx",
  "chunk_count": 45
}
```

**è§¦å‘æ—¶æœº**: ç”¨æˆ·å‘é€ `end` åï¼Œåç«¯å®Œæˆæ‰€æœ‰å¤„ç†
**å‰ç«¯åŠ¨ä½œ**:

1. éšè— loading/è¿›åº¦æ¡
2. æ˜¾ç¤ºå®Œæˆæç¤º
3. æä¾›ä¸‹è½½é“¾æ¥ï¼ˆè°ƒç”¨ä¸‹è½½æ¥å£ï¼‰

---

### 6. error - é”™è¯¯

```json
{
  "type": "error",
  "code": "END_FAILED",
  "message": "ç»“æŸä¼šè®®å¤±è´¥: è½¬å†™æ–‡æœ¬ä¸ºç©º",
  "recoverable": false
}
```

**é”™è¯¯ç å®šä¹‰**:

| code                  | è¯´æ˜           | æ˜¯å¦å¯æ¢å¤ | å‰ç«¯å¤„ç†å»ºè®®         |
| --------------------- | -------------- | ---------- | -------------------- |
| `START_FAILED`      | å¯åŠ¨ä¼šè®®å¤±è´¥   | âŒ         | æ˜¾ç¤ºé”™è¯¯ï¼Œå…è®¸é‡è¯•   |
| `DECODE_ERROR`      | éŸ³é¢‘è§£ç å¤±è´¥   | âœ…         | è·³è¿‡æ­¤ chunkï¼Œç»§ç»­   |
| `CHUNK_ERROR`       | å¤„ç†éŸ³é¢‘å—å¤±è´¥ | âœ…         | ç»§ç»­å‘é€ä¸‹ä¸€ä¸ª       |
| `END_FAILED`        | ç»“æŸä¼šè®®å¤±è´¥   | âŒ         | æ˜¾ç¤ºé”™è¯¯ï¼Œè”ç³»ç®¡ç†å‘˜ |
| `INTERNAL_ERROR`    | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | âŒ         | æ˜¾ç¤ºé”™è¯¯ï¼Œåˆ·æ–°é‡è¯•   |
| `MESSAGE_TOO_LARGE` | æ¶ˆæ¯è¿‡å¤§       | âœ…         | å‡å°éŸ³é¢‘å—å¤§å°       |
| `INVALID_MESSAGE`   | æ¶ˆæ¯æ ¼å¼é”™è¯¯   | âŒ         | æ£€æŸ¥å‘é€æ ¼å¼         |
| `INVALID_STYLE`     | æ— æ•ˆçš„æ¨¡æ¿é£æ ¼ | âœ…         | æç¤ºç”¨æˆ·é€‰æ‹©æ­£ç¡®æ¨¡æ¿ |

**å‰ç«¯åŠ¨ä½œ**:

- `recoverable: true` â†’ æ˜¾ç¤ºè­¦å‘Šï¼Œç»§ç»­è¿è¡Œ
- `recoverable: false` â†’ æ˜¾ç¤ºé”™è¯¯ï¼Œé‡ç½®ç•Œé¢

---

## ğŸ”„ å®Œæ•´çŠ¶æ€æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     connect      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœªè¿æ¥  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ è¿æ¥ä¸­  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                  â”‚
                              onopen
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   send "start"   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å½•éŸ³ä¸­   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ å·²è¿æ¥  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ receive "started"
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  send "chunk"    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿›è¡Œä¸­  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  æœåŠ¡ç«¯  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                           â”‚
     â”‚ receive "transcript"      â”‚ æ¯30ç§’è§¦å‘è½¬å†™
     â”‚                           â”‚
     â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ ç”¨æˆ·ç‚¹å‡»"ç»“æŸ"
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   send "end"     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»“æŸä¸­   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ ç”Ÿæˆä¸­   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                  â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ receive "progress"
     â”‚                            â”‚
     â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  receive "completed"  â”‚
â”‚  å·²å®Œæˆ  â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”‚ onclose
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·²æ–­å¼€  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â±ï¸ è¶…æ—¶çº¦å®š

| åœºæ™¯               | è¶…æ—¶æ—¶é—´ | å‰ç«¯å¤„ç†                       |
| ------------------ | -------- | ------------------------------ |
| WebSocket è¿æ¥     | 10s      | æç¤º"è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"     |
| ç­‰å¾… `started`   | 5s       | æç¤º"å¯åŠ¨è¶…æ—¶ï¼Œè¯·é‡è¯•"         |
| ç­‰å¾… `completed` | 120s     | æ˜¾ç¤º"ç”Ÿæˆæ—¶é—´è¾ƒé•¿ï¼Œè¯·è€å¿ƒç­‰å¾…" |
| å¿ƒè·³é—´éš”           | 30s      | è‡ªåŠ¨å‘é€ ping                  |

---

## ğŸ› å¸¸è§è”è°ƒé—®é¢˜

### é—®é¢˜ 1: æ”¶ä¸åˆ° transcript

**æ’æŸ¥**:

1. æ£€æŸ¥æ˜¯å¦æ­£ç¡®å‘é€äº† chunkï¼ˆsequence é€’å¢ï¼‰
2. æ£€æŸ¥ chunk çš„ data æ˜¯å¦éç©º
3. éœ€è¦ç´¯ç§¯ 30 ç§’æ‰ä¼šè§¦å‘ç¬¬ä¸€æ¬¡è½¬å†™

### é—®é¢˜ 2: å‘é€ end åæ²¡æ”¶åˆ° completed

**æ’æŸ¥**:

1. æ£€æŸ¥ end æ¶ˆæ¯æ ¼å¼æ˜¯å¦æ­£ç¡® `{ "type": "end" }`
2. æ£€æŸ¥æ˜¯å¦æœ‰ progress æ¶ˆæ¯ï¼ˆå¯èƒ½æ­£åœ¨å¤„ç†ï¼‰
3. æ£€æŸ¥æ˜¯å¦æ”¶åˆ° error æ¶ˆæ¯
4. æ£€æŸ¥æ—¥å¿—æ˜¯å¦æœ‰å¼‚å¸¸

### é—®é¢˜ 3: è½¬å†™å†…å®¹ä¸ºç©º

**æ’æŸ¥**:

1. æ£€æŸ¥éº¦å…‹é£æƒé™æ˜¯å¦å¼€å¯
2. æ£€æŸ¥ MediaRecorder æ˜¯å¦æ­£å¸¸å·¥ä½œ
3. æ£€æŸ¥éŸ³é¢‘æ ¼å¼ï¼ˆwebm/opusï¼‰

### é—®é¢˜ 4: çºªè¦ç”Ÿæˆå¤±è´¥

**æ’æŸ¥**:

1. æ£€æŸ¥ full_text æ˜¯å¦ä¸ºç©ºï¼ˆcompleted ä¼šè¿”å›ï¼‰
2. æ£€æŸ¥åç«¯æ—¥å¿—æ˜¯å¦æœ‰ AI è°ƒç”¨é”™è¯¯
3. æ£€æŸ¥ DEEPSEEK_API_KEY æ˜¯å¦é…ç½®

---

## ğŸ“¦ å‰ç«¯ç¤ºä¾‹ä»£ç 

```javascript
const ws = new WebSocket(`ws://${host}:8765/api/v1/ws/meeting/${meetingId}?user_id=${userId}`);

ws.onopen = () => {
  // å‘é€å¼€å§‹
  ws.send(JSON.stringify({ type: 'start', title: 'ä¼šè®®æ ‡é¢˜' }));
};

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  
  switch(data.type) {
    case 'started':
      startRecording();  // å¼€å§‹ MediaRecorder
      break;
  
    case 'transcript':
      appendTranscript(data.text);  // æ˜¾ç¤ºè½¬å†™
      break;
  
    case 'progress':
      showLoading(data.step, data.message);  // æ˜¾ç¤ºè¿›åº¦
      break;
  
    case 'completed':
      hideLoading();
      showResult(data);  // æ˜¾ç¤ºå®Œæˆ
      break;
  
    case 'error':
      hideLoading();
      showError(data.code, data.message);  // æ˜¾ç¤ºé”™è¯¯
      if (!data.recoverable) {
        resetUI();
      }
      break;
  }
};

// ç»“æŸä¼šè®®
function endMeeting() {
  ws.send(JSON.stringify({ type: 'end' }));
  // æ˜¾ç¤º"æ­£åœ¨ç”Ÿæˆçºªè¦..."ï¼Œç­‰å¾… completed
}
```

# å‰åç«¯è”è°ƒé—®é¢˜é€ŸæŸ¥è¡¨

ã€‚

## ğŸ”´ é—®é¢˜åˆ†ç±»

| ç°è±¡                | å¯èƒ½åŸå›             | è´£ä»»æ–¹    | è§£å†³æ–¹æ¡ˆ            |
| ------------------- | ------------------- | --------- | ------------------- |
| WebSocket è¿ä¸ä¸Š    | ç½‘ç»œä¸é€š/åç«¯æ²¡å¯åŠ¨ | åç«¯/è¿ç»´ | æ£€æŸ¥æœåŠ¡çŠ¶æ€        |
| è¿æ¥åé©¬ä¸Šæ–­å¼€      | meeting_id é‡å¤     | å‰ç«¯      | ç”Ÿæˆå”¯ä¸€ meeting_id |
| å‘é€ start æ— å“åº”   | æ¶ˆæ¯æ ¼å¼é”™è¯¯        | å‰ç«¯      | æ£€æŸ¥ JSON æ ¼å¼      |
| æ”¶ä¸åˆ° started      | åç«¯å¤„ç†å¼‚å¸¸        | åç«¯      | æŸ¥çœ‹åç«¯æ—¥å¿—        |
| å½•éŸ³æ— å£°            | éº¦å…‹é£æƒé™          | å‰ç«¯      | æ£€æŸ¥æµè§ˆå™¨æƒé™      |
| å‘é€ chunk æŠ¥é”™     | Base64 ç¼–ç é”™è¯¯     | å‰ç«¯      | æ£€æŸ¥ç¼–ç æ–¹å¼        |
| 30 ç§’æ—  transcript  | éŸ³é¢‘å¤ªçŸ­/é™éŸ³       | å‰ç«¯/ç”¨æˆ· | ç¡®è®¤æœ‰æœ‰æ•ˆè¯­éŸ³      |
| transcript å†…å®¹ä¹±ç  | éŸ³é¢‘ç¼–ç é—®é¢˜        | å‰ç«¯      | æ£€æŸ¥ webm/opus æ ¼å¼ |
| å‘é€ end æ— å“åº”     | ç½‘ç»œä¸­æ–­            | ç½‘ç»œ      | æ£€æŸ¥è¿æ¥çŠ¶æ€        |
| ç”Ÿæˆçºªè¦è¶…æ—¶        | è½¬å†™æ–‡æœ¬å¤ªé•¿        | åç«¯      | å¢åŠ è¶…æ—¶æ—¶é—´        |
| completed æ— æ•°æ®    | AI ç”Ÿæˆå¤±è´¥         | åç«¯      | æ£€æŸ¥ API Key        |
| ä¸‹è½½æ–‡ä»¶ 404        | æ–‡ä»¶æœªç”Ÿæˆ          | åç«¯      | æ£€æŸ¥æ–‡ä»¶è·¯å¾„        |

---

## ğŸ” è¯¦ç»†æ’æŸ¥

### 1. WebSocket è¿æ¥å¤±è´¥

**ç°è±¡**: `new WebSocket()` æŠ¥é”™æˆ– `onerror` è§¦å‘

**æ’æŸ¥**:

```bash
# åç«¯æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨
curl http://172.20.3.70:8765/system/health

# å‰ç«¯æ£€æŸ¥æ§åˆ¶å°é”™è¯¯
# æµè§ˆå™¨ â†’ F12 â†’ Console
```

**å¸¸è§åŸå› **:

- åç«¯æœåŠ¡æ²¡å¯åŠ¨ â†’ å¯åŠ¨æœåŠ¡
- é˜²ç«å¢™é˜»æŒ¡ 8765 ç«¯å£ â†’ å¼€æ”¾ç«¯å£
- meeting_id åŒ…å«ç‰¹æ®Šå­—ç¬¦ â†’ URL ç¼–ç 

---

### 2. æ”¶ä¸åˆ° transcript

**æ’æŸ¥æ­¥éª¤**:

1. **æ£€æŸ¥ chunk æ˜¯å¦å‘é€æˆåŠŸ**

```javascript
ws.send(JSON.stringify({ type: 'chunk', ... }));
console.log('chunk å‘é€æˆåŠŸ');  // ç¡®è®¤æœ‰æ—¥å¿—
```

2. **æ£€æŸ¥ chunk å†…å®¹æ˜¯å¦æœ‰æ•ˆ**

```javascript
// ç¡®ä¿ data æ˜¯éç©ºçš„ base64
console.log('chunk size:', data.length);  // åº”è¯¥ > 100
console.log('chunk preview:', data.substring(0, 50));
```

3. **æ£€æŸ¥åç«¯æ˜¯å¦æ”¶åˆ°**

```bash
# åç«¯æ—¥å¿—åº”è¯¥æ˜¾ç¤º
tail -f backendlog_live.txt | grep "chunk"
# åº”è¯¥å‡ºç°: "æ”¶åˆ° chunk #1, size: xxx"
```

4. **ç¡®è®¤ 30 ç§’ç­‰å¾…æ—¶é—´**
   è½¬å†™æ˜¯æ¯ 30 ç§’è§¦å‘ä¸€æ¬¡ï¼Œä¸æ˜¯å®æ—¶çš„ï¼

**å¦‚æœéƒ½æ²¡é—®é¢˜è¿˜æ”¶ä¸åˆ°**:

- å¯èƒ½æ˜¯éŸ³é¢‘è´¨é‡å¤ªå·®ï¼ˆé™éŸ³/å™ªéŸ³ï¼‰
- è®©æµ‹è¯•äººå‘˜å¯¹ç€éº¦å…‹é£è¯´è¯

---

### 3. çºªè¦ç”Ÿæˆå¤±è´¥

**ç°è±¡**: æ”¶åˆ° completed ä½† minutes_path ä¸ºç©ºï¼Œæˆ–ç”Ÿæˆå†…å®¹å¼‚å¸¸

**æ’æŸ¥**:

1. **æ£€æŸ¥ full_text æ˜¯å¦ä¸ºç©º**

```javascript
ws.onmessage = (e) => {
  const data = JSON.parse(e.data);
  if (data.type === 'completed') {
    console.log('full_text length:', data.full_text?.length);  // åº”è¯¥ > 100
  }
};
```

2. **æ£€æŸ¥åç«¯ AI è°ƒç”¨**

```bash
# æŸ¥çœ‹ AI ç›¸å…³æ—¥å¿—
grep "AI\|DeepSeek\|generate_minutes" backendlog_live.txt

# åº”è¯¥çœ‹åˆ°
# "AI ç”Ÿæˆè¯·æ±‚: ç¬¬ 1/3 æ¬¡å°è¯•"
# "AI çºªè¦ç”ŸæˆæˆåŠŸ: x ä¸ªè®®é¢˜"
```

3. **å¸¸è§é”™è¯¯**

```
# API Key æœªé…ç½®
DeepSeek API Key æœªé…ç½®

# API Key æ— æ•ˆ
API è®¤è¯å¤±è´¥ (401)

# ä½™é¢ä¸è¶³
API è°ƒç”¨å¤±è´¥: ä½™é¢ä¸è¶³

# ç½‘ç»œè¶…æ—¶
è¯·æ±‚è¶…æ—¶ (>60ç§’)
```

---

### 4. æ€§èƒ½é—®é¢˜

**è½¬å†™å¤ªæ…¢ï¼ˆè¶…è¿‡ 30 ç§’ï¼‰**

- æ­£å¸¸ï¼š30 ç§’è§¦å‘ä¸€æ¬¡
- å¦‚æœ 60 ç§’è¿˜æ²¡æ”¶åˆ° â†’ æ£€æŸ¥åç«¯è´Ÿè½½

**çºªè¦ç”Ÿæˆå¤ªæ…¢ï¼ˆè¶…è¿‡ 30 ç§’ï¼‰**

- æ­£å¸¸ï¼š5-15 ç§’
- å¦‚æœ 30 ç§’è¿˜æ²¡æ”¶åˆ° â†’ å¯èƒ½æ˜¯ AI æœåŠ¡æ…¢ï¼Œè€å¿ƒç­‰å¾…

---

## ğŸ“ æœ€å°å¯å¤ç°ç¤ºä¾‹

å‰ç«¯ç”¨è¿™ä¸ªä»£ç æµ‹è¯•ï¼Œèƒ½è·‘é€šå°±æ˜¯å‰ç«¯æ²¡é—®é¢˜ï¼š

```html
<!DOCTYPE html>
<html>
<head>
  <title>WebSocket Test</title>
</head>
<body>
  <button onclick="test()">å¼€å§‹æµ‹è¯•</button>
  <div id="log"></div>
  
  <script>
    function log(msg) {
      document.getElementById('log').innerHTML += msg + '<br>';
    }
  
    async function test() {
      const ws = new WebSocket('ws://172.20.3.70:8765/api/v1/ws/meeting/M' + Date.now() + '?user_id=test');
  
      ws.onopen = () => log('âœ… è¿æ¥æˆåŠŸ');
      ws.onerror = (e) => log('âŒ è¿æ¥é”™è¯¯: ' + e);
      ws.onclose = () => log('âš ï¸ è¿æ¥å…³é—­');
  
      ws.onmessage = (e) => {
        const data = JSON.parse(e.data);
        log('ğŸ“¥ æ”¶åˆ°: ' + data.type);
  
        if (data.type === 'started') {
          log('âœ… å¯ä»¥å¼€å§‹å½•éŸ³äº†');
          ws.close();
        }
        if (data.type === 'error') {
          log('âŒ é”™è¯¯: ' + data.message);
        }
      };
  
      ws.onopen = () => {
        ws.send(JSON.stringify({ type: 'start', title: 'æµ‹è¯•' }));
        log('ğŸ“¤ å‘é€ start');
      };
    }
  </script>
</body>
</html>
```

---

## ğŸ“Š æ—¥å¿—å¯¹ç…§è¡¨

| å‰ç«¯çœ‹åˆ°           | åç«¯åº”è¯¥çœ‹åˆ°                        | çŠ¶æ€              |
| ------------------ | ----------------------------------- | ----------------- |
| WebSocket è¿æ¥æˆåŠŸ | `[session_id] WebSocket å·²è¿æ¥`   | âœ… æ­£å¸¸           |
| å‘é€ start         | `[session_id] æ”¶åˆ° start æ¶ˆæ¯`    | âœ… æ­£å¸¸           |
| æ”¶åˆ° started       | `[session_id] ä¼šè®®å·²å¯åŠ¨`         | âœ… æ­£å¸¸           |
| å‘é€ chunk #1      | `[session_id] æ”¶åˆ° chunk #1`      | âœ… æ­£å¸¸           |
| æ”¶åˆ° transcript    | `[session_id] è½¬å†™å®Œæˆ: xxx å­—ç¬¦` | âœ… æ­£å¸¸           |
| å‘é€ end           | `[session_id] æ”¶åˆ° end æ¶ˆæ¯`      | âœ… æ­£å¸¸           |
| æ”¶åˆ° completed     | `[session_id] ä¼šè®®å·²ç»“æŸ`         | âœ… æ­£å¸¸           |
| -                  | `[session_id] éŸ³é¢‘è§£ç å¤±è´¥`       | âŒ å‰ç«¯æ£€æŸ¥ chunk |
| -                  | `è½¬å†™æ–‡æœ¬ä¸ºç©º`                    | âŒ æ£€æŸ¥éº¦å…‹é£     |
| -                  | `DeepSeek API Key æœªé…ç½®`         | âŒ åç«¯é…ç½®é—®é¢˜   |

---

## âœ… è”è°ƒæ£€æŸ¥æ¸…å•

å‰ç«¯ç¡®è®¤:

- [ ] èƒ½æ­£å¸¸è¿æ¥ WebSocket
- [ ] èƒ½å‘é€ start å¹¶æ”¶åˆ° started
- [ ] MediaRecorder æ¯ 1 ç§’äº§ç”Ÿ chunk
- [ ] chunk æ­£ç¡® Base64 ç¼–ç 
- [ ] èƒ½å‘é€ chunk å¹¶æ”¶åˆ° transcript
- [ ] 30 ç§’å†…æ”¶åˆ°ç¬¬ä¸€æ¬¡ transcript
- [ ] å‘é€ end åæ”¶åˆ° progress
- [ ] æœ€ç»ˆæ”¶åˆ° completed
- [ ] èƒ½æ­£ç¡®å¤„ç† error æ¶ˆæ¯

åç«¯ç¡®è®¤:

- [ ] æ­£ç¡®æ¥æ”¶æ‰€æœ‰ chunk
- [ ] æ¯ 30 ç§’è§¦å‘è½¬å†™
- [ ] å‘é€ end åç”Ÿæˆçºªè¦
- [ ] completed åŒ…å«å®Œæ•´æ•°æ®
- [ ] é”™è¯¯æ—¶å‘é€ error æ¶ˆæ¯

---

*ç‰ˆæœ¬: 1.0 | æ›´æ–°: 2026-02-27*
