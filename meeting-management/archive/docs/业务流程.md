# 会议管理业务流程

## 流程概览

```
用户 → AI 智能体 → Meeting Skill → 输出
```

---

## 主流程：会议全流程管理

### 阶段一：会议开始前

| 步骤 | 执行者 | 操作                                     | 输出            |
| ---- | ------ | ---------------------------------------- | --------------- |
| 1.1  | 用户   | 告知 AI："下午3点有产品评审会，帮我记录" | -               |
| 1.2  | AI     | 确认会议信息：时间、主题、参会人         | 会议预告        |
| 1.3  | AI     | 调用 Skill：准备会议模板                 | 空 Meeting 结构 |

### 阶段二：会议进行中（录音）

#### 场景 A：本地会议（面对面）

```
用户："开始录音"
   ↓
AI → meeting_assistant.start_recording("产品评审会")
   ↓
Skill：启动麦克风录音 → 实时保存音频分段
   ↓
用户："停止录音"
   ↓
AI → meeting_assistant.stop_recording()
   ↓
Skill：保存完整音频文件 → 返回文件路径
```

#### 场景 B：线上会议（Teams/Zoom）

```
前置：用户已配置虚拟音频设备（VB-Cable/BlackHole）

用户："开始录制线上会议"
   ↓
AI → recorder.start()  [从虚拟设备捕获音频]
   ↓
Skill：录制系统音频输出
   ↓
用户："会议结束，停止录制"
   ↓
Skill：保存音频文件
```

### 阶段三：会议后处理（核心）

| 步骤 | 执行者 | Skill 函数                        | 说明                  |
| ---- | ------ | --------------------------------- | --------------------- |
| 3.1  | AI     | `transcribe(audio_file)`        | 音频转文字            |
| 3.2  | AI     | `create_meeting_skeleton(text)` | 创建空结构            |
| 3.3  | AI     | 理解内容，填充 Meeting            | **AI 核心工作** |
| 3.4  | AI     | `save_meeting(meeting)`         | 保存文件              |
| 3.5  | AI     | 向用户汇报                        | 生成摘要              |

#### 3.3 详细：AI 内容填充

```python
# AI 读取转写文本，理解后填充

meeting.title = "产品评审会"  # 从开场白识别

meeting.topics = [
    Topic(
        title="技术方案讨论",  # 识别议题切换
        discussion_points=[     # 提取讨论要点
            "对比了微服务和单体架构",
            "微服务部署成本增加30%"
        ],
        conclusion="决定采用微服务架构",  # 识别结论性语句
        uncertain=["具体分库策略待架构评审"],  # 标记不确定性
        action_items=[
            ActionItem(
                action="整理微服务拆分方案",
                owner="张三",  # 识别"张三负责..."
                deadline="2026-03-05",  # 识别"下周三前"
                deliverable="技术文档",  # 识别交付物
                related_project=ProjectRef(  # 识别项目关联
                    project_id="PROJ-2026-001",
                    milestone="M1 技术选型"
                )
            )
        ]
    )
]

meeting.risks = ["人手紧张可能影响交付"]  # 识别风险关键词
meeting.pending_confirmations = ["第三方API费用"]  # 识别待确认点
```

### 阶段四：输出与同步

```
Skill 输出：
├── output/meetings/2026/02/M20260225_143012_xxx/
│   ├── minutes_v1.json    (结构化数据)
│   ├── minutes_v1.docx    (Word文档)
│   └── audio_backup.wav   (音频备份)
│
└── action_registry.json   (全局行动项台账)
```

| 步骤 | 执行者 | 操作                                 |
| ---- | ------ | ------------------------------------ |
| 4.1  | AI     | 读取生成的 DOCX，向用户展示纪要      |
| 4.2  | AI     | 提取行动项，询问是否加入任务系统     |
| 4.3  | 用户   | 确认/修改行动项                      |
| 4.4  | AI     | 调用外部 API，同步到任务系统（可选） |

---

## 子流程：历史会议查询

```
用户："查一下上周关于技术方案的会议"
   ↓
AI → query_meetings(
    date_range=("2026-02-18", "2026-02-25"),
    keywords=["技术方案"]
)
   ↓
Skill：检索 output/meetings/ 目录
   ↓
AI：整理结果 → 向用户汇报
```

---

## 子流程：会议纪要更新

```
用户："昨天的评审会，行动项有变化"
   ↓
AI → update_meeting(
    meeting_id="M20260225_143012_xxx",
    topics=[...更新后的内容...]
)
   ↓
Skill：创建新版本 v2 → 保存 → 更新 latest 链接
   ↓
AI：确认更新完成
```

---

## 异常处理

### 录音失败

```
用户："开始录音"
Skill：报错 [无麦克风权限]
AI：提示用户检查权限，或建议上传已有录音文件
```

### 转写质量差

```
Skill：转写完成 [置信度低]
AI：标记"转写内容可能不准确，请核对"
   → 提供原始音频供用户参考
```

### 内容理解不确定

```
AI 识别到不确定内容：
   → meeting.topics[i].uncertain.append("待确认：...")
   → meeting.pending_confirmations.append("...")
   → 在汇报时特别标注，请用户确认
```

---

## 数据流向图

```
                    ┌─────────────┐
                    │    用户      │
                    └──────┬──────┘
                           │ 语音/指令
                           ▼
                    ┌─────────────┐
                    │  AI 智能体   │
                    │  - 理解意图  │
                    │  - 调用 Skill│
                    │  - 内容填充  │
                    └──────┬──────┘
                           │ 函数调用
                           ▼
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
┌───────────────┐  ┌───────────────┐  ┌───────────────┐
│  transcribe() │  │create_meeting_│  │ save_meeting()│
│               │  │   skeleton()  │  │               │
│  音频 → 文本   │  │ 创建数据结构   │  │ JSON+DOCX+音频 │
└───────────────┘  └───────────────┘  └───────────────┘
        │                  │                  │
        └──────────────────┼──────────────────┘
                           ▼
                    ┌─────────────┐
                    │  output/    │
                    │  - 会议纪要  │
                    │  - 行动台账  │
                    │  - 音频备份  │
                    └─────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │  AI 汇报结果 │
                    │  → 用户确认  │
                    └─────────────┘
```

---

## 关键决策点

| 决策       | 判断标准                            | 处理方式               |
| ---------- | ----------------------------------- | ---------------------- |
| 议题分割   | 时间间隔>30秒 或 关键词"下一个议题" | 创建新 Topic           |
| 结论识别   | 包含"决定/确定/结论/同意"           | 填入 conclusion        |
| 行动项识别 | 包含"负责/完成/准备/提交"+人名+时间 | 创建 ActionItem        |
| 风险识别   | 包含"风险/问题/延期/困难"           | 填入 risks             |
| 不确定性   | 包含"待定/待确认/可能/暂定"         | 填入 uncertain/pending |

---

## 业务规则

1. **一事一会**：一个音频文件对应一个 Meeting，生成一个纪要
2. **版本控制**：每次更新生成新版本（v1 → v2），保留历史
3. **行动项跟踪**：所有 action_items 自动记入全局台账
4. **实体关联**：识别到的政策/企业/项目自动关联（预留字段）
5. **数据安全**：音频和纪要本地存储，不上传云端

---

## 集成点（预留）

```
未来可对接：
├── 任务系统（钉钉/飞书/企业微信）
│   └── action_items → 任务创建 API

```
