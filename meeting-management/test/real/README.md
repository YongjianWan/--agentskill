# 会议管理 - 全功能测试控制台

这是一个完整的浏览器端测试页面，覆盖所有 API 测试需求。

## 功能特性

### 1. WebSocket 实时会议测试（原有）
- ✅ 浏览器录音 (MediaRecorder API)
- ✅ WebSocket 实时通信 (start/chunk/end 协议)
- ✅ 实时转写结果显示
- ✅ AI 会议纪要生成
- ✅ 会议统计信息

### 2. REST API 测试控制台（新增）

#### 健康检查
- 检查服务状态、版本、活跃会话、Whisper 状态

#### 会议列表
- 分页获取会议列表
- 关键词搜索
- 日期范围筛选
- 点击选中会议

#### 文件上传
- 拖拽或点击上传音频文件
- 支持 MP3, WAV, M4A, WEBM
- 上传进度显示
- 自动触发转写处理

#### 当前会议操作
- 获取会议详情
- 查看/切换纪要模板（详细/简洁/行动项/高管摘要）
- 重新生成纪要（使用不同模板）
- 下载 Word/JSON 格式纪要
- 删除会议

## 使用步骤

### 1. 启动后端服务

```bash
cd meeting-management/src
uvicorn main:app --reload --port 8765
```

### 2. 打开测试页面

```
file:///C:/.../meeting-management/test/real/index.html
```

或启动简单 HTTP 服务器：

```bash
cd meeting-management/test/real
python -m http.server 8080
# 然后访问 http://localhost:8080
```

### 3. 测试流程

#### 流程 A：实时会议测试
1. 点击 **"开始会议"** 按钮
2. 允许浏览器使用麦克风
3. 对着麦克风说话（建议 10-30 秒）
4. 点击 **"结束会议"** 按钮
5. 等待 AI 生成会议纪要
6. 在 **"API 测试控制台"** 中下载纪要文件

#### 流程 B：文件上传测试
1. 展开 **"API 测试控制台"**
2. 切换到 **"文件上传"** 标签
3. 拖拽或点击上传音频文件
4. 等待后端处理完成
5. 在 **"当前会议"** 标签中下载纪要

#### 流程 C：历史会议管理
1. 展开 **"API 测试控制台"**
2. 切换到 **"会议列表"** 标签
3. 点击 **"获取会议列表"**
4. 点击某个会议选中它
5. 在 **"当前会议"** 标签中进行操作

## 页面布局

```
┌─────────────────────────────────────┐
│         🎙️ 会议管理测试控制台         │
├─────────────────────────────────────┤
│  [连接配置] 服务器/标题/用户ID        │
├─────────────────────────────────────┤
│  [会议控制] 开始会议 / 结束会议       │
├─────────────────────────────────────┤
│  [统计信息] Chunks / 转写 / 时长      │
├─────────────────────────────────────┤
│  [实时转写] 显示转写文本              │
├─────────────────────────────────────┤
│  [会议纪要] 显示 AI 生成结果          │
├─────────────────────────────────────┤
│  ▶ API 测试控制台 (点击展开)          │
│    ┌─────────────────────────────┐  │
│    │ [健康检查][会议列表][文件上传][当前会议] │
│    └─────────────────────────────┘  │
├─────────────────────────────────────┤
│  [系统日志] 详细的调试信息            │
└─────────────────────────────────────┘
```

## API 覆盖检查表

| API | 端点 | 测试方式 |
|-----|------|----------|
| WebSocket 连接 | `/ws/meeting/{id}` | 开始会议按钮 |
| 健康检查 | `GET /system/health` | API面板-健康检查标签 |
| 会议列表 | `GET /meetings` | API面板-会议列表标签 |
| 会议详情 | `GET /meetings/{id}` | API面板-当前会议-获取详情按钮 |
| 删除会议 | `DELETE /meetings/{id}` | API面板-当前会议-删除按钮 |
| 文件上传 | `POST /upload/audio` | API面板-文件上传标签 |
| 重新生成 | `POST /meetings/{id}/regenerate` | API面板-当前会议-重新生成按钮 |
| 模板列表 | `GET /templates` | API面板-当前会议-模板列表按钮 |
| 下载纪要 | `GET /meetings/{id}/download` | API面板-当前会议-下载按钮 |

## 浏览器兼容性

- Chrome 90+ ✅
- Edge 90+ ✅
- Firefox 88+ ✅
- Safari 14.1+ ✅ (有限支持)

## 技术细节

- **录音格式**: WebM/Opus (浏览器 MediaRecorder 默认)
- **采样率**: 48kHz
- **声道**: 立体声
- **比特率**: 128kbps
- **Chunk 间隔**: 1 秒
- **转写触发**: 每 30 秒

## 常见问题

### Q: 浏览器提示 "无法访问麦克风"
A: 检查浏览器权限设置，确保允许页面访问麦克风

### Q: WebSocket 连接失败
A: 检查后端服务是否启动，端口是否为 8765

### Q: API 调用失败
A: 检查 REST API Base URL 是否正确配置（默认 `http://localhost:8765/api/v1`）

### Q: 文件上传后没有反应
A: 检查：
1. 后端 ffmpeg 是否已安装
2. 文件格式是否支持
3. 后端日志是否有错误

### Q: 会议纪要为空
A: 可能是：
1. 录音时间太短（建议至少 10 秒）
2. Whisper 转写失败（检查后端日志）
3. AI 生成失败（检查 DeepSeek API）

## 更新记录

- **2026-02-27**: 
  - 扩展为全功能 API 测试控制台，添加 REST API 测试面板
  - 健康检查面板适配 Docker 部署后的新接口格式（三级状态、组件详情）
- **2026-02-26**: 初始版本，WebSocket 实时会议测试

## Docker 部署测试

使用 Docker 部署后，测试页面同样可以正常工作：

```bash
# 1. Docker 启动服务
docker-compose up -d

# 2. 修改连接配置
# 在页面中将 REST API Base URL 改为: http://localhost:8765/api/v1

# 3. 测试健康检查
# 打开 API 测试控制台 → 健康检查 → 点击"检查健康状态"
# 应显示: 整体状态、版本、运行时间、各组件状态（API/数据库/模型/磁盘/WebSocket）
```

### Docker 健康检查面板说明

健康检查面板会显示以下信息：

| 组件 | 显示内容 |
|------|----------|
| 整体状态 | ok / degraded / error，带颜色标识 |
| 版本 | 服务端版本号（如 1.2.0） |
| 运行时间 | 服务已运行的时长 |
| API 服务 | 接口服务状态 |
| 数据库 | 数据库连接状态 |
| 模型 | 模型名称、运行设备、GPU 是否可用 |
| 磁盘 | 剩余空间、使用率 |
| WebSocket | 当前活跃会话数 |
